# üêõ –ë–∞–≥–∏ –≤ –∑–∞–ø–∏—Å–∏ –µ–¥—ã

## –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ —É—Ç–æ—á–Ω–µ–Ω–∏–∏

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω"
2. –ë–æ—Ç: "–ö–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –±–æ–ª—å—à–æ–≥–æ –±–∞–Ω–∞–Ω–∞?"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "140–≥"
4. –ë–æ—Ç –∑–∞–ø–∏—Å—ã–≤–∞–ª: "–∫—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ (–≤–∞—Ä–µ–Ω–∞—è) (140–≥)" ‚ùå

**–ü–æ—á–µ–º—É:**
–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è –±–æ—Ç –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–ª –∏—Å—Ö–æ–¥–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –µ–¥—ã –≤ `state_data`. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–ª, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤ OpenAI —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç –Ω–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–µ ("140–≥"), –±–µ–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ("–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω"). OpenAI —Ç–µ—Ä—è–ª—Å—è –∏ –ø—Ä–∏–¥—É–º—ã–≤–∞–ª —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç.

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è (—Å—Ç—Ä–æ–∫–∏ 2013-2017)

**–ë—ã–ª–æ:**
```typescript
await setUserState(userId, 'logging_food', { clarification_attempt: 1 })
```

**–°—Ç–∞–ª–æ:**
```typescript
await setUserState(userId, 'logging_food', { 
  clarification_attempt: 1,
  original_description: foodDescription  // ‚Üê –°–æ—Ö—Ä–∞–Ω—è–µ–º!
})
```

### 2. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—Ç–≤–µ—Ç–æ–º (—Å—Ç—Ä–æ–∫–∏ 1470-1477)

**–ë—ã–ª–æ:**
```typescript
await handleFoodLogging(userId, message.chat.id, user.id, message.text, clarificationAttempt)
```

**–°—Ç–∞–ª–æ:**
```typescript
let fullDescription = message.text
if (clarificationAttempt > 0 && stateData.data?.original_description) {
  fullDescription = `${stateData.data.original_description} ${message.text}`
  console.log('Combined food description:', fullDescription)
}
await handleFoodLogging(userId, message.chat.id, user.id, fullDescription, clarificationAttempt)
```

---

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω"
2. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ state: `{ clarification_attempt: 1, original_description: "–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω" }`
3. –ë–æ—Ç: "–ö–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –±–æ–ª—å—à–æ–≥–æ –±–∞–Ω–∞–Ω–∞?"
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "140–≥"
5. –ë–æ—Ç –∫–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç: `"–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω 140–≥"`
6. OpenAI –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç!
7. –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ë–æ–ª—å—à–æ–π –±–∞–Ω–∞–Ω (140–≥)" ‚úÖ

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ï–¥–∞ —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–Ø–±–ª–æ–∫–æ"
ü§ñ –ë–æ—Ç: "–ö–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å —è–±–ª–æ–∫–∞?"
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "200–≥"
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: "–Ø–±–ª–æ–∫–æ 200–≥" ‚Üí –ö–ë–ñ–£ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ï–¥–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤–µ—Å–æ–º
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ 150–≥"
ü§ñ –ë–æ—Ç: —Å—Ä–∞–∑—É –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –±–µ–∑ —É—Ç–æ—á–Ω–µ–Ω–∏–π
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ 150–≥"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
```
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–†–∏—Å —Å –∫—É—Ä–∏—Ü–µ–π"
ü§ñ –ë–æ—Ç: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –ø–æ—Ä—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞"
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–†–∏—Å 100–≥, –∫—É—Ä–∏—Ü–∞ 150–≥"
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: "–†–∏—Å —Å –∫—É—Ä–∏—Ü–µ–π –†–∏—Å 100–≥, –∫—É—Ä–∏—Ü–∞ 150–≥"
```

---

## –î–µ–ø–ª–æ–π

```bash
supabase functions deploy telegram-bot --no-verify-jwt
```

---

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `supabase/functions/telegram-bot/index.ts`:
  - –°—Ç—Ä–æ–∫–∏ 2013-2017: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `original_description` –≤ state
  - –°—Ç—Ä–æ–∫–∏ 1470-1477: –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º

---

## –ó–∞–º–µ—Ç–∫–∏

- –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω —Ä–∞–∑** (`clarificationAttempt === 0`)
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —É—Ç–æ—á–Ω–µ–Ω–∏–∏ –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –≤ –ø–æ–ª–µ `description`
- –õ–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å: `console.log('Combined food description:', fullDescription)`

---

---

## –ü—Ä–æ–±–ª–µ–º–∞ 2: –£—Ç–æ—á–Ω–µ–Ω–∏–µ –ø—Ä–∏ —É–∂–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤–µ—Å–∞—Ö

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ë–∞–Ω–∞–Ω 400–≥, –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–∞—è –∫–ª—É–±–Ω–∏–∫–∞ 100–≥, –û–≤—Å—è–Ω–∫–∞ 60–≥, –ü—Ä–æ—Ç–µ–∏–Ω tobe pro whey 40–≥"
2. –ë–æ—Ç: "–ö–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ –æ–≤—Å—è–Ω–∫–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 60–≥)?" ‚ùå
3. **–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –≤–µ—Å–∞ –£–ñ–ï —É–∫–∞–∑–∞–Ω—ã, –Ω–æ –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏–µ

**–ü–æ—á–µ–º—É:**
OpenAI –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª —á—Ç–æ –≤–µ—Å–∞ —É–∂–µ —É–∫–∞–∑–∞–Ω—ã –≤ –æ–ø–∏—Å–∞–Ω–∏–∏. –ü—Ä–æ–º–ø—Ç –±—ã–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–µ—Ç–∫–∏–º –∏ –Ω–µ –¥–∞–≤–∞–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤.

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2

### –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ (—Å—Ç—Ä–æ–∫–∏ 1964-1966, 1979-1982)

**–ë—ã–ª–æ:**
```typescript
: '\n1. –ï—Å–ª–∏ –≥—Ä–∞–º–º–æ–≤–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ - —É—Ç–æ—á–Ω–∏ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ (–¢–û–õ–¨–ö–û –û–î–ò–ù –†–ê–ó)'
```

**–°—Ç–∞–ª–æ:**
```typescript
: `\n1. –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –æ–ø–∏—Å–∞–Ω–∏–µ: –µ—Å–ª–∏ –£–ñ–ï —É–∫–∞–∑–∞–Ω—ã –≥—Ä–∞–º–º—ã/–º–ª/—à—Ç—É–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–±–∞–Ω–∞–Ω 150–≥", "—è–±–ª–æ–∫–æ 200–≥", "—Ä–∏—Å 100–≥ –∫—É—Ä–∏—Ü–∞ 150–≥") - –ù–ï –∑–∞–ø—Ä–∞—à–∏–≤–∞–π —É—Ç–æ—á–Ω–µ–Ω–∏–µ!
2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–π —É—Ç–æ—á–Ω–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–µ—Å–∞ –†–ï–ê–õ–¨–ù–û –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–±–∞–Ω–∞–Ω", "—Ç–∞—Ä–µ–ª–∫–∞ —Å—É–ø–∞", "–ø–æ—Ä—Ü–∏—è —Ä–∏—Å–∞")
3. –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç –±–µ–∑ –≤–µ—Å–∞ - —Å–ø—Ä–æ—Å–∏ –ø—Ä–æ –Ω–µ–≥–æ`

// –ü–ª—é—Å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ:
–í–ê–ñ–ù–û: 
- –ï—Å–ª–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –µ—Å—Ç—å —Ü–∏—Ñ—Ä—ã —Å "–≥", "–º–ª", "–∫–≥" - —ç—Ç–æ –£–ñ–ï —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ!
- –ü—Ä–∏–º–µ—Ä—ã —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤–µ—Å–æ–º: "–±–∞–Ω–∞–Ω 400–≥", "–æ–≤—Å—è–Ω–∫–∞ 60–≥", "–º–æ–ª–æ–∫–æ 200–º–ª"
- –ü—Ä–∏–º–µ—Ä—ã –ë–ï–ó –≤–µ—Å–∞: "–±–∞–Ω–∞–Ω", "—Ç–∞—Ä–µ–ª–∫–∞ —Å—É–ø–∞", "–ø–æ—Ä—Ü–∏—è –∫—É—Ä–∏—Ü—ã"
```

---

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Å–µ –≤–µ—Å–∞ —É–∫–∞–∑–∞–Ω—ã
```
üë§: "–ë–∞–Ω–∞–Ω 400–≥, –û–≤—Å—è–Ω–∫–∞ 60–≥, –ú–æ–ª–æ–∫–æ 200–º–ª"
ü§ñ: –°—Ä–∞–∑—É –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ß–∞—Å—Ç—å –≤–µ—Å–æ–≤ —É–∫–∞–∑–∞–Ω–∞
```
üë§: "–ë–∞–Ω–∞–Ω 400–≥, –æ–≤—Å—è–Ω–∫–∞, –º–æ–ª–æ–∫–æ 200–º–ª"
ü§ñ: "–ö–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –ø–æ—Ä—Ü–∏–∏ –æ–≤—Å—è–Ω–∫–∏?" (—Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ –æ–≤—Å—è–Ω–∫—É)
üë§: "60–≥"
ü§ñ: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç "–ë–∞–Ω–∞–Ω 400–≥, –æ–≤—Å—è–Ω–∫–∞ 60–≥, –º–æ–ª–æ–∫–æ 200–º–ª" ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–µ—Å–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã
```
üë§: "–ë–∞–Ω–∞–Ω –∏ –æ–≤—Å—è–Ω–∫–∞"
ü§ñ: "–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—ã–π –≤–µ—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞"
üë§: "–ë–∞–Ω–∞–Ω 150–≥, –æ–≤—Å—è–Ω–∫–∞ 50–≥"
ü§ñ: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ
```

---

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ü—Ä–æ–±–ª–µ–º–∞ 2)

- `supabase/functions/telegram-bot/index.ts`:
  - –°—Ç—Ä–æ–∫–∏ 1964-1966: —É–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI
  - –°—Ç—Ä–æ–∫–∏ 1979-1982: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–∞ –±–∞–≥–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
**–î–∞—Ç–∞:** 2025-10-24

