# üéâ C.I.D. v2.0 - Patch Notes

## üì¢ –î–ª—è broadcast-—Ä–∞—Å—Å—ã–ª–∫–∏ (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)

---

### ‚ú® –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ—Ä–æ—Ç–∫–∏–π (–¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```json
{
  "message": "üéâ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ C.I.D. v2.0!**\n\n**–ß—Ç–æ –Ω–æ–≤–æ–≥–æ:**\n\nüî• **Streak —Å–∏—Å—Ç–µ–º–∞** ‚Äî –Ω–µ —Ç–µ—Ä—è–π —Å–µ—Ä–∏—é –¥–Ω–µ–π!\n‚ö° **–ë—ã—Å—Ç—Ä—ã–π –ª–æ–≥** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π —á–∞—Å—Ç—ã–µ –±–ª—é–¥–∞\nüìà **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–æ—Ä–∏–π, –±–µ–ª–∫–∞ –∏ –≤–µ—Å–∞\nüíß **–£—á–µ—Ç –≤–æ–¥—ã** ‚Äî –ø–æ–ª–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è\nüõí **–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫** ‚Äî AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ 3/7/14 –¥–Ω–µ–π\nüìä **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ AI-–æ—Ç—á–µ—Ç—ã** ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n‚è∞ **–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** ‚Äî –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è\n\nüí° **–û–±–Ω–æ–≤–∏ –±–æ—Ç –∫–æ–º–∞–Ω–¥–æ–π /start!**\n\n–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏ —Å—Ç–∞–ª–æ –ø—Ä–æ—â–µ! üí™",
  "onlyActiveSubscribers": false,
  "delayMs": 150,
  "keyboard": [
    [{"text": "üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤–∏–Ω–∫–∏", "callback_data": "main_menu"}]
  ]
}
```

---

### üåü –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–¥—Ä–æ–±–Ω—ã–π (–¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤)

```json
{
  "message": "üéâ **C.I.D. v2.0 ‚Äî –ö—Ä—É–ø–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!**\n\n–ü—Ä–∏–≤–µ—Ç! –ú—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –º–µ—Å—è—Ü –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∫—Ä—É—Ç—ã—Ö —Ñ–∏—á, –∫–æ—Ç–æ—Ä—ã–µ —Å–¥–µ–ª–∞—é—Ç —Ç–≤–æ–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏ –µ—â–µ –ø—Ä–æ—â–µ:\n\n**üî• Streak —Å–∏—Å—Ç–µ–º–∞ (—Å–µ—Ä–∏–∏)**\n–ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞–ª –µ–¥—É 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥? –ü–æ–ª—É—á–∞–µ—à—å –±–µ–π–¥–∂–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é! –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π —Å–µ—Ä–∏—é ‚Äî —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n**‚ö° –ë—ã—Å—Ç—Ä—ã–π –ª–æ–≥ –µ–¥—ã**\n–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–∞—Å—Ç—ã–µ –±–ª—é–¥–∞ –∫–∞–∫ —à–∞–±–ª–æ–Ω—ã –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –æ–¥–Ω–∏–º –Ω–∞–∂–∞—Ç–∏–µ–º. \"–ú–æ–π –∑–∞–≤—Ç—Ä–∞–∫\", \"–õ–∞–Ω—á –≤ –æ—Ñ–∏—Å–µ\" ‚Äî —Ä–∞–∑ –∏ –≥–æ—Ç–æ–≤–æ!\n\n**üìà –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**\n–ö—Ä–∞—Å–∏–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:\n‚Ä¢ üìä –ö–∞–ª–æ—Ä–∏–∏ –∑–∞ 30 –¥–Ω–µ–π\n‚Ä¢ ü•© –ë–µ–ª–æ–∫ –∑–∞ 30 –¥–Ω–µ–π\n‚Ä¢ ‚öñÔ∏è –í–µ—Å –∑–∞ 90 –¥–Ω–µ–π\n–°–º–æ—Ç—Ä–∏ –¥–∏–Ω–∞–º–∏–∫—É –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞–Ω!\n\n**üíß –£—á–µ—Ç –≤–æ–¥—ã**\n–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ç—Ä–µ–∫–∏–Ω–≥ –≤–æ–¥—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º, —Ü–µ–ª—å—é –∏ –∏—Å—Ç–æ—Ä–∏–µ–π. –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ \"1 –ª–∏—Ç—Ä –≤–æ–¥—ã\" ‚Äî –∏ –≤—Å–µ –≥–æ—Ç–æ–≤–æ!\n\n**üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫**\nAI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –Ω–∞ 3/7/14 –¥–Ω–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–≤–æ–µ–≥–æ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è. –ö–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –≥–æ—Ç–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç!\n\n**üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ AI-–æ—Ç—á–µ—Ç—ã**\n–ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –ø–æ–ª—É—á–∞–µ—à—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç: –∏—Ç–æ–≥–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å, –∏–Ω—Å–∞–π—Ç—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è!\n\n**‚è∞ –£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**\nAI-–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –µ–¥—ã –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è. –ë–æ–ª—å—à–µ –Ω–µ –∑–∞–±—É–¥–µ—à—å!\n\n---\n\nüí° **–ö–æ–º–∞–Ω–¥–∞ /start –æ–±–Ω–æ–≤–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å!**\n\nüöÄ –ù–∞—á–∏–Ω–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–æ–≤–∏–Ω–∫–∞–º–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!\n\n–ö–æ–º–∞–Ω–¥–∞ C.I.D. üíô",
  "onlyActiveSubscribers": true,
  "delayMs": 150,
  "keyboard": [
    [{"text": "üöÄ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "callback_data": "main_menu"}],
    [{"text": "üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å", "callback_data": "show_charts"}],
    [{"text": "üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫", "callback_data": "shopping_list"}]
  ]
}
```

---

### üíé –í–∞—Ä–∏–∞–Ω—Ç 3: –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π (–¥–ª—è trial –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

```json
{
  "message": "üéâ **C.I.D. v2.0 —É–∂–µ –∑–¥–µ—Å—å!**\n\n–ü—Ä–∏–≤–µ—Ç! –ú—ã –¥–æ–±–∞–≤–∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–≤—Ä–∞—Ç—è—Ç —Ç—Ä–µ–∫–∏–Ω–≥ –ø–∏—Ç–∞–Ω–∏—è –≤ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ:\n\n‚ú® **7 –Ω–æ–≤—ã—Ö –∫—Ä—É—Ç—ã—Ö —Ñ–∏—á:**\n\n1Ô∏è‚É£ **Streak —Å–∏—Å—Ç–µ–º–∞** ‚Äî –±–µ–π–¥–∂–∏ –∑–∞ —Å–µ—Ä–∏–∏ –¥–Ω–µ–π\n2Ô∏è‚É£ **–ë—ã—Å—Ç—Ä—ã–π –ª–æ–≥** ‚Äî —à–∞–±–ª–æ–Ω—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –±–ª—é–¥\n3Ô∏è‚É£ **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–æ—Ä–∏–π/–±–µ–ª–∫–∞/–≤–µ—Å–∞\n4Ô∏è‚É£ **–£—á–µ—Ç –≤–æ–¥—ã** ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è\n5Ô∏è‚É£ **–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫** ‚Äî AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é\n6Ô∏è‚É£ **AI-–æ—Ç—á–µ—Ç—ã** ‚Äî –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n7Ô∏è‚É£ **–£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** ‚Äî –Ω–µ –∑–∞–±—ã–≤–∞–π –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å\n\nüéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏:**\n‚Ä¢ +50% —à–∞–Ω—Å–æ–≤ –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏\n‚Ä¢ -60% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\n‚Ä¢ +40% —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞\n\nüí™ **–¢–≤–æ–π trial:**\n–û—Å—Ç–∞–ª–æ—Å—å **{{trial_days}}** –¥–Ω–µ–π ‚Äî —É—Å–ø–µ–π –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—Å–µ –Ω–æ–≤–∏–Ω–∫–∏!\n\nüí° –ö–æ–º–∞–Ω–¥–∞ /start –æ–±–Ω–æ–≤–∏—Ç –±–æ—Ç\n\nüöÄ –î–æ—Å—Ç–∏–≥–∞–π —Ü–µ–ª–µ–π –ª–µ–≥–∫–æ —Å C.I.D.!",
  "onlyActiveSubscribers": false,
  "delayMs": 150,
  "keyboard": [
    [{"text": "üöÄ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å", "callback_data": "main_menu"}],
    [{"text": "üíé –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É", "callback_data": "buy_subscription"}]
  ]
}
```

---

## üõ†Ô∏è –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å broadcast

### –î–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ (–≤—Å–µ–º):

```bash
curl -X POST 'https://itlqgwevcuoysdmuttwy.supabase.co/functions/v1/broadcast-message' \
  -H 'Authorization: Bearer YOUR_SERVICE_KEY' \
  -H 'Content-Type: application/json' \
  -d '{ /* JSON –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1 */ }'
```

### –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ (—Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–º):

```bash
curl -X POST 'https://itlqgwevcuoysdmuttwy.supabase.co/functions/v1/broadcast-message' \
  -H 'Authorization: Bearer YOUR_SERVICE_KEY' \
  -H 'Content-Type: application/json' \
  -d '{ /* JSON –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 2 */ }'
```

---

## ‚úÖ –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:

1. ‚úÖ **–ó–∞–¥–µ–ø–ª–æ–π telegram-bot** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å —Ñ–∏–∫—Å–æ–º –æ–ø–ª–∞—Ç—ã
2. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Å–µ–±–µ** ‚Äî –æ—Ç–ø—Ä–∞–≤—å —Å–Ω–∞—á–∞–ª–∞ —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–º—É telegram_id
3. ‚úÖ **–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç** ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π, –ø–æ–¥—Ä–æ–±–Ω—ã–π –∏–ª–∏ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π
4. ‚úÖ **–û—Ç–ø—Ä–∞–≤—å –≤—Å–µ–º** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π broadcast-message —Ñ—É–Ω–∫—Ü–∏—é

---

## üêõ Hotfix –≤–∫–ª—é—á–µ–Ω –≤ v2.0:

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø–ª–∞—Ç–æ–π –ø–æ–¥–ø–∏—Å–∫–∏**
- –û—à–∏–±–∫–∞: "Text buttons are unallowed in the inline keyboard"
- –ü—Ä–∏—á–∏–Ω–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `paymentData.paymentUrl` –≤–º–µ—Å—Ç–æ `paymentData.payment_url`
- –°—Ç–∞—Ç—É—Å: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ telegram-bot/index.ts:1796

---

## üìä –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. ‚úÖ Streak —Å–∏—Å—Ç–µ–º–∞ —Å –±–µ–π–¥–∂–∞–º–∏ (SQL + bot handlers)
2. ‚úÖ Quick Log —à–∞–±–ª–æ–Ω—ã –µ–¥—ã (SQL + bot handlers)
3. ‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (QuickChart API integration)
4. ‚úÖ –£—á–µ—Ç –≤–æ–¥—ã (SQL + –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
5. ‚úÖ –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ (AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
6. ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ AI-–æ—Ç—á–µ—Ç—ã (–∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
7. ‚úÖ –£–º–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (AI-–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è)
8. ‚úÖ Broadcast —Å–∏—Å—Ç–µ–º–∞ (–º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –§–∏–∫—Å payment_url (inline keyboard error)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ "üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å" –∏ "üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫" –≤ navigationButtons
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ detectIntent –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤–æ–¥—ã

### SQL –ú–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ add_streak_system.sql
- ‚úÖ add_meal_templates.sql
- ‚úÖ add_weight_tracking.sql
- ‚úÖ add_water_tracking.sql
- ‚úÖ add_broadcast_helpers.sql

### Edge Functions:
- ‚úÖ telegram-bot (–æ–±–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ smart-notifications (–Ω–æ–≤—ã–π)
- ‚úÖ weekly-ai-report (–Ω–æ–≤—ã–π)
- ‚úÖ progress-charts (–Ω–æ–≤—ã–π)
- ‚úÖ shopping-list (–Ω–æ–≤—ã–π)
- ‚úÖ broadcast-message (–Ω–æ–≤—ã–π)

---

**üöÄ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é –∏ —Ä–∞—Å—Å—ã–ª–∫–µ!**
